@model AeroDroxUAV.Models.DroneServices
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Add New Drone Suvidha";
}

<div class="container py-3">
    <div class="row justify-content-center">
        <div class="col-lg-12 col-xl-10">
            <div class="card shadow border-0">
                <div class="card-header bg-gradient-primary text-white py-3">
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <i class="fas fa-concierge-bell fa-lg"></i>
                        </div>
                        <div>
                            <h1 class="h4 mb-0">Add New Drone Suvidha</h1>
                            <p class="mb-0 opacity-75 small">Enter suvidha details below</p>
                        </div>
                    </div>
                </div>
                <div class="card-body p-4">
                    <form method="post" asp-controller="DroneServices" asp-action="Create" enctype="multipart/form-data" id="serviceForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input asp-for="Name" class="form-control form-control-sm" 
                                           id="name" placeholder="Enter service name" required />
                                    <label for="name" class="small">
                                        <i class="fas fa-concierge-bell me-2"></i>Suvidha Name
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <select asp-for="Category" class="form-select form-select-sm" id="category" required>
                                        <option value="">Select Category</option>
                                        <option value="Agriculture">Agriculture</option>
                                        <option value="SecuritySurveillance">Security & Surveillance</option>
                                        <option value="Mapping">Mapping</option>
                                        <option value="Photography">Photography</option>
                                        <option value="DroneShows">Drone Shows</option>
                                    </select>
                                    <label for="category" class="small">
                                        <i class="fas fa-layer-group me-2"></i>Category
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <div class="form-floating">
                                    <input asp-for="Duration" class="form-control form-control-sm" 
                                           id="duration" placeholder="e.g., 2-4 Hours, 1 Day, etc." required />
                                    <label for="duration" class="small">
                                        <i class="fas fa-clock me-2"></i>Duration
                                    </label>
                                    <div class="form-text small">
                                        Enter duration (e.g., "2-4 Hours", "1 Day", "1 Week")
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Media Upload Section -->
                        <div class="mb-4">
                            <h6 class="mb-3">
                                <i class="fas fa-images me-2 text-primary"></i>Media Upload
                                <small class="text-muted ms-2">(Choose either Image or Video)</small>
                            </h6>
                            
                            <!-- Image Upload -->
                            <div class="card mb-3">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="mediaType" id="imageOption" value="image" checked onclick="toggleMediaType()">
                                        <label class="form-check-label fw-semibold small" for="imageOption">
                                            <i class="fas fa-image me-2 text-primary"></i>Upload Image
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body p-3" id="imageUploadSection">
                                    <div class="mb-2">
                                        <label for="imageFile" class="form-label small mb-1">Choose Image File:</label>
                                        <input type="file" class="form-control form-control-sm" id="imageFile" name="imageFile" 
                                               accept="image/*" onchange="previewMedia(this, 'image')">
                                    </div>
                                    <div class="form-text small">
                                        Recommended: JPG, PNG, max 5MB, aspect ratio 16:9 for best view
                                    </div>
                                    <div class="mt-2" id="imagePreview" style="display: none;">
                                        <p class="text-muted small mb-1">Image Preview:</p>
                                        <img id="imagePreviewImg" class="img-thumbnail" style="max-height: 150px;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Video Upload -->
                            <div class="card">
                                <div class="card-header bg-light py-2">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="mediaType" id="videoOption" value="video" onclick="toggleMediaType()">
                                        <label class="form-check-label fw-semibold small" for="videoOption">
                                            <i class="fas fa-video me-2 text-success"></i>Upload Video
                                        </label>
                                    </div>
                                </div>
                                <div class="card-body p-3" id="videoUploadSection" style="display: none;">
                                    <div class="mb-2">
                                        <label for="videoFile" class="form-label small mb-1">Choose Video File:</label>
                                        <input type="file" class="form-control form-control-sm" id="videoFile" name="videoFile" 
                                               accept="video/*" onchange="previewMedia(this, 'video')">
                                    </div>
                                    <div class="form-text small">
                                        Recommended: MP4, WebM, max 50MB, duration under 2 minutes
                                    </div>
                                    <div class="mt-2" id="videoPreview" style="display: none;">
                                        <p class="text-muted small mb-1">Video Preview:</p>
                                        <video id="videoPreviewPlayer" class="img-thumbnail" style="max-height: 150px; max-width: 100%;" controls>
                                            Your browser does not support the video tag.
                                        </video>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-floating">
                                <textarea asp-for="Description" class="form-control form-control-sm" 
                                          id="description" placeholder="Enter service description"
                                          style="height: 100px;" required></textarea>
                                <label for="description" class="small">
                                    <i class="fas fa-align-left me-2"></i>Suvidha Description
                                </label>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-floating">
                                <textarea asp-for="Benefits" class="form-control form-control-sm" 
                                          id="benefits" placeholder="Enter service benefits"
                                          style="height: 80px;"></textarea>
                                <label for="benefits" class="small">
                                    <i class="fas fa-star me-2"></i>Benefits
                                </label>
                                <div class="form-text small">
                                    List the benefits of this suvidha (separate with commas)
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div class="form-check">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActive" checked>
                                <label class="form-check-label small" for="isActive">
                                    <i class="fas fa-toggle-on me-2"></i>Active Suvidha
                                </label>
                                <div class="form-text small">
                                    Uncheck to hide this suvidha from users
                                </div>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between mt-4">
                            <div>
                                <button type="submit" class="btn btn-primary btn-sm px-4">
                                    <i class="fas fa-save me-2"></i>Add Suvidha
                                </button>
                            </div>
                            <div>
                                <a href="/DroneServices/Index" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-times me-2"></i>Cancel
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Form validation
            $('#serviceForm').submit(function(e) {
                e.preventDefault();
                
                var isValid = true;
                $(this).find('[required]').each(function() {
                    if ($(this).val() === '') {
                        $(this).addClass('is-invalid');
                        isValid = false;
                    } else {
                        $(this).removeClass('is-invalid');
                    }
                });
                
                // Check if at least one media is selected
                var imageFile = $('#imageFile')[0].files[0];
                var videoFile = $('#videoFile')[0].files[0];
                
                if (!imageFile && !videoFile && $('#videoOption').prop('checked')) {
                    $('#videoFile').addClass('is-invalid');
                    isValid = false;
                }
                
                if (isValid) {
                    this.submit();
                }
            });
            
            // Real-time validation
            $('input[required], textarea[required], select[required]').on('blur', function() {
                if ($(this).val() === '') {
                    $(this).addClass('is-invalid');
                } else {
                    $(this).removeClass('is-invalid');
                }
            });
        });

        function toggleMediaType() {
            const imageOption = document.getElementById('imageOption');
            const videoOption = document.getElementById('videoOption');
            const imageUploadSection = document.getElementById('imageUploadSection');
            const videoUploadSection = document.getElementById('videoUploadSection');
            const imageFileInput = document.getElementById('imageFile');
            const videoFileInput = document.getElementById('videoFile');
            
            if (imageOption.checked) {
                imageUploadSection.style.display = 'block';
                videoUploadSection.style.display = 'none';
                videoFileInput.value = ''; // Clear video file input
                document.getElementById('videoPreview').style.display = 'none';
            } else if (videoOption.checked) {
                imageUploadSection.style.display = 'none';
                videoUploadSection.style.display = 'block';
                imageFileInput.value = ''; // Clear image file input
                document.getElementById('imagePreview').style.display = 'none';
            }
        }

        function previewMedia(input, type) {
            if (type === 'image') {
                const preview = document.getElementById('imagePreviewImg');
                const imagePreview = document.getElementById('imagePreview');
                
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        imagePreview.style.display = 'block';
                    }
                    
                    reader.readAsDataURL(input.files[0]);
                } else {
                    preview.src = '';
                    imagePreview.style.display = 'none';
                }
            } else if (type === 'video') {
                const preview = document.getElementById('videoPreviewPlayer');
                const videoPreview = document.getElementById('videoPreview');
                
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    const url = URL.createObjectURL(file);
                    
                    preview.src = url;
                    videoPreview.style.display = 'block';
                    
                    // Clean up URL when video is loaded
                    preview.onload = function() {
                        URL.revokeObjectURL(url);
                    }
                } else {
                    preview.src = '';
                    videoPreview.style.display = 'none';
                }
            }
        }
    </script>
    
    <style>
        .bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card {
            border-radius: 12px;
            overflow: hidden;
        }
        
        .card .card {
            border: 1px solid #dee2e6;
        }
        
        .form-control-sm, .form-select-sm {
            border-radius: 8px;
            border: 1px solid #dee2e6;
            padding: 0.375rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .form-control-sm:focus, .form-select-sm:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 0.375rem 1rem;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .btn-outline-secondary {
            border-radius: 8px;
            padding: 0.375rem 1rem;
            font-size: 0.875rem;
        }
        
        label.small {
            font-size: 0.875rem;
        }
        
        .form-text.small {
            font-size: 0.8rem;
        }
        
        .form-check-input:checked {
            background-color: #667eea;
            border-color: #667eea;
        }
    </style>
}